{% extends "base.html" %}

{% block content %}
<div class="header">
    <h2><i class="fas fa-users"></i> All Students</h2>
    
    <div class="header-actions">
        <form action="{{ url_for('search_students') }}" method="get" class="search-form">
            <input type="text" name="q" placeholder="Search by name, roll no, or course..." 
                   value="{{ search_query if search_query else '' }}">
            <button type="submit"><i class="fas fa-search"></i> Search</button>
        </form>
        
        <a href="{{ url_for('add_student') }}" class="btn-add">
            <i class="fas fa-plus"></i> Add New Student
        </a>
    </div>
</div>

{% if students %}
<div class="table-responsive">
    <table class="student-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Roll No</th>
                <th>Name</th>
                <th>Course</th>
                <th>Year</th>
                <th>Grade</th>
                <th>Attendance</th>
                <th>Fees</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.id }}</td>
                <td>{{ student.roll_no }}</td>
                <td>
                    <div class="student-name">
                        <strong>{{ student.name }}</strong>
                        <small>{{ student.email }}</small>
                    </div>
                </td>
                <td>{{ student.course }}</td>
                <td>{{ student.year }}</td>
                <td>
                    <span class="grade-badge grade-{{ student.grade|lower|replace('+', '') }}">
                        {{ student.grade }}
                    </span>
                </td>
                <td>
                    <div class="attendance-container">
                        <div class="attendance-bar">
                            <div class="attendance-fill" id="attendance-{{ student.id }}"></div>
                        </div>
                        <span class="attendance-text">{{ student.attendance }}%</span>
                    </div>
                </td>
                <td>
                    {% if student.fees_paid %}
                    <span class="status-badge status-paid">
                        <i class="fas fa-check"></i> Paid
                    </span>
                    {% else %}
                    <span class="status-badge status-pending">
                        <i class="fas fa-clock"></i> Pending
                    </span>
                    {% endif %}
                </td>
                <td class="action-buttons">
                    <a href="{{ url_for('view_student', student_id=student.id) }}" 
                       class="btn-action btn-view" title="View Details">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="{{ url_for('edit_student', student_id=student.id) }}" 
                       class="btn-action btn-edit" title="Edit">
                        <i class="fas fa-edit"></i>
                    </a>
                    <a href="{{ url_for('delete_student', student_id=student.id) }}" 
                       class="btn-action btn-delete" title="Delete"
                       onclick="return confirm('Are you sure you want to delete student: {{ student.name }}?')">
                        <i class="fas fa-trash"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="pagination">
    <p>Total Students: {{ students|length }}</p>
</div>
{% else %}
<div class="empty-state">
    <i class="fas fa-user-graduate fa-4x"></i>
    <h3>No Students Found</h3>
    <p>There are no students in the database yet.</p>
    <a href="{{ url_for('add_student') }}" class="btn-primary">
        <i class="fas fa-plus"></i> Add Your First Student
    </a>
</div>
{% endif %}

<!-- YEH SCRIPT ADD KARO: -->
<script>
// Simple JavaScript solution
window.addEventListener('load', function() {
    // Har attendance text element ko process karo
    var attendanceTexts = document.querySelectorAll('.attendance-text');
    
    attendanceTexts.forEach(function(textElement) {
        // Attendance value nikalo
        var text = textElement.textContent.trim();
        var attendanceValue = text.replace('%', '');
        
        // Same row mein attendance-fill element dhundho
        var row = textElement.closest('tr');
        var fillElement = row.querySelector('.attendance-fill');
        
        // Width set karo
        if (fillElement) {
            fillElement.style.width = attendanceValue + '%';
            fillElement.style.backgroundColor = '#4CAF50';
            fillElement.style.height = '8px';
            fillElement.style.borderRadius = '4px';
            fillElement.style.display = 'block';
        }
    });
});
</script>
{% endblock %}